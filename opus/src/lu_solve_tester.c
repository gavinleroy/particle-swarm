#include <assert.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>

#include "lu_solve.h"
// #include "perf_lu_solve.h"

#define N 16

int main()
{

  double A[N * N] = {

      0.727004,  0.352501,  0.619187,  0.121148,  0.719571,  0.380477,
      0.647047,  0.396413,  0.333781,  0.716425,  0.810315,  0.694767,
      0.608161,  0.0555867, 0.0581884, 0.894317,  0.4537,    0.294025,
      0.299685,  0.192981,  0.696769,  0.343618,  0.143122,  0.242455,
      0.0127578, 0.959763,  0.688887,  0.235739,  0.0163131, 0.226277,
      0.359547,  0.467677,  0.986356,  0.311673,  0.553059,  0.758177,
      0.101528,  0.943486,  0.191176,  0.839162,  0.737192,  0.0816504,
      0.895152,  0.811852,  0.163094,  0.775341,  0.395311,  0.0655271,
      0.224765,  0.21045,   0.226089,  0.552077,  0.404555,  0.492873,
      0.995402,  0.248342,  0.107052,  0.93086,   0.878941,  0.380853,
      0.961693,  0.489557,  0.286102,  0.619616,  0.368854,  0.539778,
      0.18105,   0.601404,  0.506934,  0.066533,  0.192087,  0.955037,
      0.284196,  0.404333,  0.447089,  0.741501,  0.290844,  0.803051,
      0.945085,  0.385619,  0.419331,  0.923914,  0.319758,  0.711091,
      0.491028,  0.317001,  0.563753,  0.215429,  0.299196,  0.46094,
      0.580904,  0.0809161, 0.237906,  0.0152139, 0.677507,  0.737502,
      0.980302,  0.992244,  0.340261,  0.481231,  0.957889,  0.325922,
      0.625548,  0.131126,  0.58566,   0.22643,   0.912085,  0.0299609,
      0.393644,  0.980692,  0.367432,  0.0921515, 0.615181,  0.168105,
      0.852376,  0.0696167, 0.6391,    0.883504,  0.0538708, 0.767359,
      0.791714,  0.356428,  0.965956,  0.133664,  0.364367,  0.660669,
      0.812769,  0.881067,  0.939155,  0.420677,  0.354303,  0.91171,
      0.243855,  0.314131,  0.150953,  0.956172,  0.26629,   0.886591,
      0.632209,  0.57443,   0.598113,  0.213237,  0.307576,  0.677104,
      0.244516,  0.760233,  0.912514,  0.899697,  0.189168,  0.133023,
      0.695815,  0.598837,  0.507222,  0.769209,  0.158768,  0.275652,
      0.101255,  0.87756,   0.71216,   0.416665,  0.640254,  0.543734,
      0.391585,  0.885057,  0.289468,  0.574392,  0.577875,  0.900336,
      0.586296,  0.0710508, 0.210458,  0.606829,  0.852402,  0.798384,
      0.666376,  0.575353,  0.32958,   0.418782,  0.391689,  0.20064,
      0.450079,  0.518017,  0.709544,  0.6119,    0.90732,   0.739562,
      0.255073,  0.0780265, 0.903832,  0.83748,   0.658271,  0.642292,
      0.985693,  0.872661,  0.195551,  0.574315,  0.31132,   0.154023,
      0.145515,  0.99504,   0.222948,  0.306791,  0.146166,  0.440585,
      0.408615,  0.376604,  0.386218,  0.434971,  0.396182,  0.925296,
      0.589949,  0.395608,  0.698956,  0.685425,  0.818039,  0.0420416,
      0.610205,  0.383676,  0.511104,  0.129771,  0.0013751, 0.718038,
      0.8061,    0.593288,  0.790116,  0.202307,  0.549379,  0.806007,
      0.966935,  0.960232,  0.295433,  0.77642,   0.550846,  0.389001,
      0.241695,  0.874607,  0.844344,  0.965467,  0.672177,  0.352296,
      0.0271121, 0.516436,  0.327375,  0.0962037, 0.145728,  0.0904053,
      0.0393297, 0.164824,  0.41126,   0.0332355, 0.487031,  0.48891,
      0.303251,  0.344317,  0.924173,  0.0786474

  };

  double b[N] = {

      0.989371051902607,    0.16083435577434158, 0.1307035669864277,
      0.044226069541300594, 0.9314928475472982,  0.07867658984824755,
      0.47024210149048173,  0.15453419295941673, 0.7102000131781833,
      0.9713385085249133,   0.8267509428867362,  0.001004352050195223,
      0.9777399475013981,   0.04569203082173412, 0.7979130127735137,
      0.559849895624688

  };

  double expected_x[N] = {

      7.11748755854855,    -5.525064449501342,  1.6116689113545222,
      -0.9539482805740318, -0.627768234232105,  -3.5651509358998537,
      4.850684535715503,   -0.6719395327603855, -1.7575582113253712,
      -0.5414428800118654, -1.4227143672973102, -0.6838582926788137,
      -0.598515669549663,  -1.7838395422584647, 6.289334126142913,
      -1.6596060344963743

  };

  int *ipiv = (int *)aligned_alloc(32, N * sizeof(int));
  int ret = lu_solve(N, A, ipiv, b); // gaussian_elimination_solve(8, Ab, x);
  assert(ret == 0);
  printf("-ACT- -EXP-\n");
  for (int i = 0; i < N; i++)
    printf("%f %f\n", b[i], expected_x[i]);
  // perf_test_ge_solve(8, Ab, x);
  return 0;
}
